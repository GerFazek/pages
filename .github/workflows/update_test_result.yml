name: Update Test Result

on:
  workflow_dispatch:
    inputs:
      generate_test_result:
        description: 'Generate random test result'
        required: true
        default: 'Passed'
        type: choice
        options:
          - 'Passed'
          - 'Failed'

jobs:
  update_test_result:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      # Add your other build or setup steps here, if any...

      # Generate the random test result based on user input (manual trigger)
      - name: Generate Test Result
        id: generate_result
        run: |
          RESULT="${{ github.event.inputs.generate_test_result }}"
          echo "::set-output name=result::$RESULT"

      # Update the HTML file with the new test result
      - name: Update HTML File
        run: |
          RESULT="${{ steps.generate_result.outputs.result }}"
          NEW_RESULT="<tr><td>$(date +'%Y-%m-%d %H:%M:%S')</td><td>Regression</td><td class=\"$RESULT\">$RESULT</td><td><a href=\"https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}\">Link to GitHub Actions</a></td></tr>"
          sed -i "s|<table><tbody>|<table><tbody>$NEW_RESULT|" html_content/boards_api_test_all.html
          git config user.name "GitHub Actions"
          git config user.email "actions@users.noreply.github.com"
          git add html_content/boards_api_test_all.html
          git commit -m "Update test result"
          git push --set-upstream origin ${{ github.ref }}
        env:
          GITHUB_TOKEN: ${{ secrets.UPDATE_HTML_CONTENT }}